<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>3D SIM Carousel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #111;
      transition: background 0.6s ease;
      color: #fff; /* Body matn rangi umumiy oq bo'lsin */
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .carousel-3d {
      perspective: 1000px;
      perspective-origin: 50% 50%;
    }

    .stage {
      position: relative;
      width: 100%;
      max-width: 400px;
      height: 350px;
      margin: auto;
      transform-style: preserve-3d;
      cursor: grab;
      min-height: 250px;
    }

    .card-3d {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 220px;
      height: 160px;
      transform-style: preserve-3d;
      transform-origin: center center;
      transition: transform 0.4s ease;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      padding: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border-top: 4px solid transparent;
      color: #333; /* Karta ichidagi matn rangi */
    }

    .btn-savat {
      border-radius: 6px;
      padding: 5px 10px;
      font-size: 13px;
      font-weight: 600;
      color: #fff; /* Tugma matni rangi */
    }

    .dragging { cursor: grabbing !important; }

    .operator-info {
      position: absolute;
      top: 20px;
      left: 20px;
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.6s ease;
      max-width: 320px;
      z-index: 10;
      text-shadow: 0 0 5px rgba(0,0,0,0.5); /* Matnga yengil soya qo'shish */
    }

    .operator-info h2 {
      font-size: 30px;
      font-weight: 900;
      margin-bottom: 6px;
    }
    .operator-info p {
      font-size: 15px;
      line-height: 1.5;
    }


    .operator-info.active {
      opacity: 1;
      transform: translateX(0);
    }

    @media (max-width: 500px) {
      .stage {
        height: 250px;
        min-height: 200px;
      }
      .card-3d {
        width: 180px;
        height: 130px;
      }
      .operator-info {
        left: 10px;
        max-width: 80%;
        top: 10px;
      }
      .operator-info h2 {
        font-size: 20px;
      }
      .operator-info p {
        font-size: 12px;
      }
    }

    @media (max-width: 400px) {
      .stage {
        height: 220px;
        min-height: 180px;
      }
      .card-3d {
        width: 160px;
        height: 120px;
      }
      .operator-info {
        left: 5px;
        max-width: 85%;
        top: 5px;
      }
      .operator-info h2 {
        font-size: 18px;
      }
      .operator-info p {
        font-size: 11px;
      }
    }

    @media (max-width: 320px) {
      .stage {
        height: 200px;
        min-height: 160px;
      }
      .card-3d {
        width: 140px;
        height: 100px;
      }
      .operator-info h2 {
        font-size: 16px;
      }
      .operator-info p {
        font-size: 10px;
      }
    }

    /* Ensure the site works on very small screens */
    @media (max-height: 600px) {
      body {
        padding: 0.5rem;
      }
      .stage {
        height: 200px;
        min-height: 150px;
      }
      .operator-info {
        top: 5px;
        left: 5px;
        max-width: 90%;
      }
    }

    /* Landscape orientation adjustments */
    @media (orientation: landscape) and (max-height: 500px) {
      .stage {
        height: 180px;
        min-height: 140px;
      }
      .card-3d {
        width: 150px;
        height: 110px;
      }
      .operator-info {
        top: 2px;
        left: 2px;
        max-width: 95%;
      }
      .operator-info h2 {
        font-size: 14px;
      }
      .operator-info p {
        font-size: 9px;
      }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-2 sm:p-4 relative">
  <!-- Operator matnlari -->
  <div id="yota-info" class="operator-info">
    <h2>Yota</h2>
    <p>Cheksiz internet, 11-15 MB/s<br>Ichki tarmoqda bepul qo‘ng‘iroqlar<br>Tarif: oyiga 300 rubl</p>
  </div>
  <div id="mts-info" class="operator-info">
    <h2>MTS</h2>
    <p>200 GB internet<br>Ichki tarmoqda bepul qo‘ng‘iroqlar<br>Tarif: oyiga 270 rubl</p>
  </div>
  <div id="beeline-info" class="operator-info">
    <h2>Beeline</h2>
    <p>50 GB internet<br>Ichki tarmoqda qo‘ng‘iroqlar<br>Tarif: oyiga 269 rubl</p>
  </div>
  <div id="megafon-info" class="operator-info">
    <h2>Megafon</h2>
    <p>50 GB internet<br>Ichki tarmoqda bepul qo‘ng‘iroqlar<br>Tarif: oyiga 259 rubl</p>
  </div>
  <div id="t2-info" class="operator-info">
    <h2>T2</h2>
    <p>50 GB internet<br>Ichki tarmoqda bepul qo‘ng‘iroqlar<br>Tarif: oyiga 249 rubl</p>
  </div>

  <section class="w-full max-w-md">
    <div class="carousel-3d">
      <div id="stage" class="stage mx-auto"></div>
    </div>
    <!-- Auto-rotation indicator -->
    <div id="auto-rotate-indicator" class="fixed bottom-4 right-4 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-xs opacity-0 transition-opacity duration-300">
      <span id="auto-rotate-text">Auto-rotation: ON</span>
    </div>
  </section>

  <script>
    const cardsData = [
      { id: 'yota', title: 'Yota Cheksiz', price: '₽29.99', phone: '+7 (999) 555-00-11', color: '#0077FF', tag: 'VIP raqam' },
      { id: 'mts', title: 'MTS 200GB', price: '₽27.99', phone: '+7 (916) 218-60-62', color: '#E30611', tag: 'Omadli raqam' },
      { id: 'beeline', title: 'Beeline 50GB', price: '₽26.99', phone: '+7 (903) 123-45-67', color: '#FFCC00', tag: 'Oltin seriya' },
      { id: 'megafon', title: 'Megafon 50GB', price: '₽25.99', phone: '+7 (999) 384-72-71', color: '#00B956', tag: 'Biznes seriya' },
      { id: 't2', title: 'T2 50GB', price: '₽24.99', phone: '+7 (901) 777-88-99', color: '#000000', tag: 'Qora seriya' },
    ];

    let radius = 250;
    const stage = document.getElementById('stage');
    let rotateY = 0, dragging = false, lastX = 0, velocity = 0, lastTime = null;
    let autoRotate = true;
    let autoRotateSpeed = 0.5; // degrees per frame
    let autoRotatePaused = false;

    function createCards() {
      const n = cardsData.length;
      cardsData.forEach((d, i) => {
        const angle = (360 / n) * i;
        const wrapper = document.createElement('div');
        wrapper.className = 'card-3d';
        wrapper.dataset.id = d.id;
        wrapper.dataset.color = d.color;
        wrapper.style.transform = `translate(-50%, -50%) rotateY(${angle}deg) translateZ(${radius}px)`;
        wrapper.innerHTML = `
          <div class="card-inner" style="border-top-color:${d.color}">
            <div class="flex justify-between items-center">
              <h3 class="font-medium text-xs">${d.title}</h3>
              <span class="font-bold text-xs" style="color:${d.color}">${d.price}</span>
            </div>
            <p class="text-sm font-bold text-center">${d.phone}</p>
            <div class="flex justify-between items-center text-xs">
              <span>${d.tag}</span>
              <button class="btn-savat" style="background:${d.color};">Savatga</button>
            </div>
          </div>
        `;
        stage.appendChild(wrapper);
      });
    }

    function animate(ts) {
      if (!lastTime) lastTime = ts;
      const dt = (ts - lastTime) / 1000;
      lastTime = ts;

      if (dragging) {
        rotateY += velocity * dt * 0.1;
        velocity *= 0.9;
        autoRotatePaused = true;
        // Resume auto-rotation after 3 seconds of inactivity
        setTimeout(() => {
          if (!dragging) autoRotatePaused = false;
        }, 3000);
      } else if (autoRotate && !autoRotatePaused) {
        rotateY += autoRotateSpeed;
      }

      stage.style.transform = `rotateX(-5deg) rotateY(${rotateY}deg)`;
      updateBackground();
      requestAnimationFrame(animate);
    }

    // Orqa fon rangiga qarab matn rangini avtomatik tanlaydigan funksiya
    function getContrastColor(r, g, b) {
        // Yiqilish algoritmiga asoslangan yorug'likni hisoblash
        const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
        return luminance > 0.5 ? 'black' : 'white';
    }


    function updateBackground() {
      const cards = [...stage.children];
      let minDiff = Infinity, activeId = null, activeColor = '#111';
      cards.forEach(card => {
        const m = card.style.transform.match(/rotateY\((-?\d+\.?\d*)deg\)/);
        if (m) {
          const angle = (parseFloat(m[1]) + rotateY) % 360;
          const diff = Math.min(Math.abs(angle), Math.abs(angle - 360), Math.abs(angle + 360)); /* 0ga eng yaqin burchakni topish */
          if (diff < minDiff) {
            minDiff = diff;
            activeId = card.dataset.id;
            activeColor = card.dataset.color;
          }
        }
      });

      try {
        const r = parseInt(activeColor.slice(1,3), 16);
        const g = parseInt(activeColor.slice(3,5), 16);
        const b = parseInt(activeColor.slice(5,7), 16);
        document.body.style.background = `rgba(${r},${g},${b},0.15)`;

        // Operator ma'lumotlari matni rangini yangilash
        const allInfos = document.querySelectorAll('.operator-info');
        allInfos.forEach(info => {
            info.classList.remove('active');
            info.style.color = getContrastColor(r,g,b); /* Har bir infoga kontrast rang berish */
        });

      } catch (e) {
        document.body.style.background = '#111';
        document.querySelectorAll('.operator-info').forEach(info => {
            info.classList.remove('active');
            info.style.color = 'white'; /* Xato bo'lganda defolt oq rang */
        });
      }

      const activeInfo = document.getElementById(activeId + '-info');
      if (activeInfo) {
        activeInfo.classList.add('active');
        // Yuqorida getContrastColor bilan rang berilgan, shuning uchun bu yerda takrorlash shart emas.
        // activeInfo.style.color = getContrastColor (r,g,b)
      }
    }

    function addDrag() {
      let startX = 0, startRot = 0;
      
      // Prevent default touch behaviors that might interfere
      stage.addEventListener('touchstart', e => {
        e.preventDefault();
      }, { passive: false });
      
      stage.addEventListener('touchmove', e => {
        e.preventDefault();
      }, { passive: false });

      stage.addEventListener('pointerdown', e => {
        dragging = true;
        autoRotatePaused = true;
        if (stage.setPointerCapture) {
          stage.setPointerCapture(e.pointerId);
        }
        startX = e.clientX;
        startRot = rotateY;
        lastX = e.clientX;
        velocity = 0;
        document.body.classList.add('dragging');
      });
      
      window.addEventListener('pointermove', e => {
        if (!dragging) return;
        const dx = e.clientX - startX;
        rotateY = startRot + dx * 0.4;
        velocity = e.clientX - lastX;
        lastX = e.clientX;
      });
      
      window.addEventListener('pointerup', () => {
        dragging = false;
        document.body.classList.remove('dragging');
        // Resume auto-rotation after a delay
        setTimeout(() => {
          if (!dragging) autoRotatePaused = false;
        }, 2000);
      });

      stage.addEventListener('touchstart', e => {
        if (e.touches.length === 1) {
          dragging = true;
          autoRotatePaused = true;
          startX = e.touches[0].clientX;
          startRot = rotateY;
          lastX = e.touches[0].clientX;
          velocity = 0;
          document.body.classList.add('dragging');
        }
      });
      
      stage.addEventListener('touchmove', e => {
        if (!dragging || e.touches.length !== 1) return;
        const dx = e.touches[0].clientX - startX;
        rotateY = startRot + dx * 0.4;
        velocity = e.touches[0].clientX - lastX;
        lastX = e.touches[0].clientX;
      });
      
      stage.addEventListener('touchend', () => {
        dragging = false;
        document.body.classList.remove('dragging');
        // Resume auto-rotation after a delay
        setTimeout(() => {
          if (!dragging) autoRotatePaused = false;
        }, 2000);
      });

      // Add click/tap to pause/resume auto-rotation
      stage.addEventListener('click', () => {
        autoRotate = !autoRotate;
        if (autoRotate) {
          autoRotatePaused = false;
        }
        updateAutoRotateIndicator();
      });
    }

    function updateAutoRotateIndicator() {
      const indicator = document.getElementById('auto-rotate-indicator');
      const text = document.getElementById('auto-rotate-text');
      
      if (autoRotate && !autoRotatePaused) {
        indicator.style.opacity = '1';
        text.textContent = 'Auto-rotation: ON';
      } else {
        indicator.style.opacity = '0';
        text.textContent = 'Auto-rotation: OFF';
      }
    }

    createCards();
    addDrag();
    updateAutoRotateIndicator();
    requestAnimationFrame(animate);
  </script>
</body>
</html>
